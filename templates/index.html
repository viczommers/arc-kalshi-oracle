<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Delphi Pool | Kalshi x Circle</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <div class="fluid-container">
        <div class="fluid-wave" id="asciiCanvas"></div>
    </div>

    <div class="wallet-header">
        <div class="wallet-header-container">
            <button id="connectBtn" class="btn btn-primary">Connect MetaMask ðŸ¦Š</button>
            <div id="walletInfo" class="wallet-info hidden">
                <span><strong>Connected:</strong> <span id="walletAddress"></span></span>
                <span><strong>Network:</strong> <span id="networkName"></span></span>
                <button id="addPstTokenBtn" class="btn btn-secondary">Add Pool Token</button>
                <button id="refreshBalances" class="btn btn-secondary" disabled>Refresh Balances</button>
                <button id="disconnectBtn" class="btn btn-secondary">Disconnect</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1>
                <span id="word1" class="scrambled">K9#XM@4L7P2Q5R</span>
                <span> </span>
                <span id="word2" class="scrambled">N&8R*5S1</span>
            </h1>

            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>

            <p class="subtitle">Kalshi Odds as Prediction Markets Oracle for USDC/EURC Treasury Management</p>
        </header>

        <div class="balance-section accordion-item active">
            <div class="accordion-header">
                <h2>Token Balances</h2>
                <span class="accordion-icon"></span>
            </div>
            <div class="accordion-content">
                <div class="accordion-body">
                    <div id="balances" class="balances-grid">
                <div class="balance-card">
                    <h3>USDC ðŸ‡ºðŸ‡¸</h3>
                    <p class="balance-amount" id="usdcBalance">--</p>
                </div>
                <div class="balance-card">
                    <h3>EURC ðŸ‡ªðŸ‡º</h3>
                    <p class="balance-amount" id="eurcBalance">--</p>
                </div>
            </div>
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <div style="flex: 1; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 14px;">Treasury Proportions</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div>
                            <strong>USDC:</strong> <span id="usdToEurProp">--</span>%
                        </div>
                        <div>
                            <strong>EURC:</strong> <span id="eurToUsdProp">--</span>%
                        </div>
                        <div>
                            <strong>Contract:</strong> <a id="treasuryContract" href="#" target="_blank" style="font-family: monospace; font-size: 12px; color: #667eea; text-decoration: none;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">-- ðŸ”—</a>
                        </div>
                    </div>
                </div>
                <div style="flex: 1; padding: 10px; background: #f5f5f5; border-radius: 5px;">
                    <h3 style="margin: 0 0 10px 0; font-size: 14px;">Kalshi Market Data</h3>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <div>
                            <strong>EUR/USD Rate:</strong> <span id="eurUsdRate">Loading...</span>
                        </div>
                        <div>
                            <strong>Probability:</strong> <span id="kalshiProbability">Loading...</span>
                        </div>
                        <div>
                            <strong>Ticker:</strong> <a id="kalshiTicker" href="#" target="_blank" style="font-family: monospace; font-size: 12px; color: #667eea; text-decoration: none;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">Loading... ðŸ”—</a>
                        </div>
                    </div>
                </div>
            </div>
            <div style="margin-top: 15px; padding: 10px; background: #f0f7ff; border-radius: 5px;">
                <h3 style="margin: 0 0 10px 0; font-size: 18px; color: #667eea; text-align: center;">INTERACT WITH POOL ðŸ”„</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button id="getTokensBtn" class="btn btn-primary" disabled style="display: none;">Get Test Tokens</button>
                    <button id="approveAndDepositBtn" class="btn btn-primary" disabled>Approve & Deposit</button>
                    <button id="approveAndWithdrawBtn" class="btn btn-primary" disabled>Approve & Withdraw</button>
                    <button id="approveTokensBtn" class="btn btn-secondary" disabled style="display: none;">Approve Only</button>
                    <button id="depositAllBtn" class="btn btn-secondary" disabled style="display: none;">Deposit Only</button>
                </div>
            </div>
                </div>
            </div>
        </div>

        <div class="oracle-section" style="display: none;">
            <h2>Submit Oracle Data</h2>
            <form id="oracleForm">
                <div class="form-group">
                    <label for="valueInput">Value (1-99999)</label>
                    <input
                        type="number"
                        id="valueInput"
                        min="1"
                        max="99999"
                        placeholder="e.g., 95000 for 95.000%"
                        required
                    >
                    <small>Percentage * 1000 (e.g., 95000 = 95.000%)</small>
                </div>

                <div class="form-group">
                    <label for="resolutionTimestamp">Resolution Timestamp</label>
                    <input
                        type="datetime-local"
                        id="resolutionTimestamp"
                        required
                    >
                    <small>When the market will resolve</small>
                </div>

                <button type="submit" class="btn btn-primary" id="submitBtn" disabled>
                    Submit Data
                </button>
            </form>

            <div id="result" class="result hidden"></div>
        </div>


        <div class="oracle-info">
            <h2>Oracle Information</h2>
            <div id="oracleDetails" class="info-grid">
                <div class="info-item">
                    <span class="label">Contract:</span>
                    <a id="contractAddress" href="#" target="_blank" style="font-family: monospace; font-size: 14px; color: #667eea; text-decoration: none;" onmouseover="this.style.textDecoration='underline'" onmouseout="this.style.textDecoration='none'">Loading... ðŸ”—</a>
                </div>
                <div class="info-item">
                    <span class="label">Owner:</span>
                    <span id="ownerAddress">Loading...</span>
                </div>
                <div class="info-item">
                    <span class="label">Total Data Points:</span>
                    <span id="totalDataPoints">Loading...</span>
                </div>
                <div class="info-item">
                    <span class="label">Latest Observation (EUR/USD):</span>
                    <span id="latestObservation">Loading...</span>
                </div>
            </div>
        </div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
